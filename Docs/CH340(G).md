The CH340G is a popular, slightly dated yet still reliable USB interface chip. It's most commonly used for USB-TO-UART applications, such as when we need to talk to a micro controller.

[Datasheet](https://static.efetividade.net/img/ch340g-datasheet-34852.pdf)

### **Features of the CH340G:**

- USB 2.0 Full-Speed device
	Supports up to 12 Mbps for serial communication.

- Can operate with minimal external component requirements.
	A crystal, two load caps and two decoupling caps.
	(Only on paper. Adding some other components is favorable.)

- Provides a virtual serial port.
	The chip creates a COM port on your PC.

- Baud rate range from 50 bps to 2 Mbps
	Supports common baud rates like *4800, 9600, 19200, 38400, 57600, 115200, 230400, 460800, 921600* etc.

- Supports common flow control signals
	RTS, DTR, DCD, RI, DSR and CTS.

- Supports CH-341 drivers.
	Latest drivers [here](https://www.wch-ic.com/downloads/ch341ser_exe.html) 
	New drivers may cause BSODs or crashes unless they're fixed by WCH, though. Recommend <2019 drivers.

- 5 v and 3.3 v compatible, with a SO-16 package.

### **Absolute Maximum Ratings**

| Symbol | Name                  | Minimum | Maximum | Unit |
| ------ | --------------------- | ------- | ------- | ---- |
| TA     | Operating Temperature | -40     | 85      | °C   |
| TS     | Storage Temperature   | -40     | 125     | °C   |
| Vcc    | Supply Rail Voltage   | -0.5    | 6.5     | V    |
| VIO    | IO pin voltage        | -0.5    | Vcc+0.5 | V    |
Note: *3.3V operation* requires a minimum of **3.3V ±1%** voltage input and might get damaged over **3.7V**. 

Note: *5V operation* requires a minimum of **4.5V ±1%** voltage input and might get damaged over **5.5V.**

### **Pinout**

| 1   | GND | \| 16 | VCC  |
| --- | --- | ----- | ---- |
| 2   | TXD | \| 15 | R232 |
| 3   | RXD | \| 14 | RTS# |
| 4   | V3  | \| 13 | DTR# |
| 5   | UD+ | \| 12 | DCD# |
| 6   | UD- | \| 11 | RI   |
| 7   | XI  | \| 10 | DSR# |
| 8   | XO  | \| 9  | CST# |

### **Application Notes**

* CH340 chip has built in USB pull-up and on-chip signal termination. That being said, adding **22Ω resistors in series with the USB lines, close to the UD pins** seem to *improve reliability* even if the datasheet doesn't strictly recommend it. 

* During operation, a 12Mhz clock signal should be provided by placing an appropriate crystal between XI and XO pins. The crystal's pins should have 22pF load capacitors.

* Adding a **1MΩ resistor between the crystal's pins seem to help with the startup**, this is not seen in the datasheet but it's recommended to add it on the PCB design, and turn it into a DNP if it causes any problems.

- When using 5V operation, supply 5V to VCC pin, and decouple the internal 3.3V reference with a capacitor of 4.7-20nF from V3 pin to ground.

- When using 3.3V operation, tie V3 pin to VCC pin and supply 3.3V power.

- Refer to the **provided schematic** for the auto reset/boot circuit, labeled with transistors "Q1" and "Q2".

- From testing, leftover **flux** on the PCB seems to interfere with USB communication, **symptoms include: the chip randomly disconnecting, device manager reporting "Unknown device", and serial communication errors.**  I haven't seen anybody mention this online (maybe it's just me), my theory is that leftover flux sometimes can act as a dielectric layer on top of the silkscreen and mess with signal return paths and/or cause "leakage" by shorting pins in the MΩ ranges.

- Note that the USB data traces need to be routed as differential pairs with an impedance of 90 Ω ±10% (per the USB 2.0 standard), or the chip may fail the USB handshake or behave unstably. Edge-coupled coplanar waveguides are recommended to help maintain impedance and reduce EMI.

### **3.3V Application Schematic**
![CH340G 3.3V Example Schematic](images/CH340G_3.3v_example_schematic.jpg)

The schematic is from my custom ESP32 devboard project.

The upper part of the schematic includes a power gating circuit controlled by USB presence (Q4, Q3), alongside a DNP jumper resistor if the power gate needs to be skipped for debugging purposes. (R15)